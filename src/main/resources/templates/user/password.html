<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="/include/head :: commonHeader">
    <meta charset="UTF-8">
    <title>修改密码</title>
</head>
<body >

<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header">修改密码</div>
                <form id="form" class="layui-form"  action="" method="post">
                     <div class="layui-card-body">

                        <div class="layui-form" >
                            <div class="layui-form-item">
                                <label class="layui-form-label">当前密码</label>
                                <div class="layui-input-inline">
                                    <input type="password" name="oldPassword" lay-verify="required" lay-vertype="tips" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">新密码</label>
                                <div class="layui-input-inline">
                                    <input type="password" id="password" name="password" lay-verify="pass|required" lay-vertype="tips" autocomplete="off"  class="layui-input">
                                </div>
                                <div class="layui-form-mid layui-word-aux">6到16个字符</div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">确认新密码</label>
                                <div class="layui-input-inline">
                                    <input type="password" id="repassword" name="repassword" lay-verify="repass|required" lay-vertype="tips" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-input-block">
                                    <button class="layui-btn" lay-submit="" lay-filter="setmypass">确认修改</button>
                                </div>
                            </div>
                        </div>

                    </div>

                </form>
            </div>

        </div>
    </div>
</div>
</body>
<script>
    layui.use('form', function(){
        var layer = layui.layer;
        var form = layui.form;
        form.on('submit(setmypass)', function(data){
            var password = data.field.password;
            var repassword = data.field.repassword;
            if (password != repassword) {
                layer.msg('两次密码输入不一致', {icon: 5,shift:6});
                $("#repassword").focus();
                return false;
            }

            $.ajax({
                url:"/tSBaseUser/updatePassword",
                type:"post",
                dataType : "json",
                data: $("#form").serialize(),
                success:function(res){
                    console.info(res);
                    debugger;
                   if (res.success) {

                       layer.alert('密码修改成功，您将退出后重新登录', {
                           closeBtn: 0,
                           title : "提示",
                       }, function(){
                           parent.window.location.href='/logout';
                       });

                   }else{
                       layer.msg(res.msg, {icon: 5,shift:6});
                   }
                }
            });
            return false;
        });
    });
</script>
</html>